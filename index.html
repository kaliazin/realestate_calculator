<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∞—Ä—Ç–æ—Å—Ç—ñ –Ω–µ—Ä—É—Ö–æ–º–æ—Å—Ç—ñ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }
        
        .date-section {
            background: #ecf0f1;
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 20px;
            padding: 20px;
        }
        
        .section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 18px;
            transition: all 0.3s ease;
        }
        
        .object-info-section {
            height: fit-content;
        }
        
        .section:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
        }
        
        .form-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
        }
        
        label {
            font-weight: 600;
            color: #34495e;
            font-size: 0.9em;
        }
        
        input, select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .currency-display {
            background: #e8f4f8;
            padding: 8px;
            border-radius: 6px;
            font-weight: 600;
            color: #2980b9;
            text-align: right;
        }
        
        .dashboard {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border-radius: 10px;
            padding: 18px;
            height: fit-content;
        }
        
        .dashboard h2 {
            color: white;
            border-bottom-color: rgba(255,255,255,0.3);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 15px;
        }
        
        .info-item {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        .info-item strong {
            display: block;
            font-size: 0.9em;
            margin-bottom: 5px;
            opacity: 0.9;
        }
        
        .info-item span {
            font-size: 1em;
            font-weight: 600;
        }
        
        .payment-schedule-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75em;
            margin-top: 15px;
        }
        
        .schedule-table thead {
            background: #2c3e50;
        }
        
        .schedule-table th {
            background: #2c3e50;
            color: white;
            padding: 8px 4px;
            text-align: center;
            font-size: 0.9em;
            border: 1px solid #34495e;
        }
        
        .schedule-table td {
            padding: 6px 4px;
            text-align: center;
            border: 1px solid #ddd;
            font-size: 0.85em;
        }
        
        .schedule-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .schedule-table tbody tr:hover {
            background: #e3f2fd;
        }
        
        .first-payment {
            background: #e8f5e8 !important;
        }
        
        .grace-period {
            background: #fff3cd !important;
        }
        
        .table-total {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin: 20px;
        }
        
        .action-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .action-button.save {
            background: #27ae60;
        }
        
        .action-button.save:hover {
            background: #219653;
        }
        
        .exchange-rate-button {
            background: #f39c12;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .exchange-rate-button:hover {
            background: #e67e22;
        }
        
        .exchange-rate-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        @media (max-width: 900px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .date-section {
                grid-template-columns: 1fr;
            }
            
            .form-group {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
        
        @media print {
            body {
                background: white;
            }
            
            .container {
                box-shadow: none;
            }
            
            .action-buttons {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∞—Ä—Ç–æ—Å—Ç—ñ –Ω–µ—Ä—É—Ö–æ–º–æ—Å—Ç—ñ</h1>
        </div>
        
        <div class="date-section">
            <div class="form-group">
                <label for="calculationDate">–î–∞—Ç–∞ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É:</label>
                <input type="date" id="calculationDate">
            </div>
            <div class="form-group">
                <label for="firstPaymentDate">–î–∞—Ç–∞ –ø–µ—Ä—à–æ–≥–æ –ø–ª–∞—Ç–µ–∂—É:</label>
                <input type="date" id="firstPaymentDate">
            </div>
        </div>
        
        <div class="content">
            <div>
                <div class="section object-info-section">
                    <h2>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –æ–±'—î–∫—Ç</h2>
                    
                    <div class="form-group">
                        <label for="complexName">–ù–∞–∑–≤–∞ –ñ–ö:</label>
                        <select id="complexName">
                            <option value="">–û–±–µ—Ä—ñ—Ç—å –ñ–ö</option>
                            <option value="–î136">–î136</option>
                            <option value="The ONE">The ONE</option>
                            <option value="Olegiv Podil">Olegiv Podil</option>
                            <option value="Metropolis">Metropolis</option>
                            <option value="Lucky Land">Lucky Land</option>
                            <option value="Park Lake City">Park Lake City</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="buildingNumber">–ù–æ–º–µ—Ä –±—É–¥–∏–Ω–∫—É:</label>
                        <input type="text" id="buildingNumber" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä –±—É–¥–∏–Ω–∫—É">
                    </div>
                    
                    <div class="form-group">
                        <label for="sectionNumber">–ù–æ–º–µ—Ä —Å–µ–∫—Ü—ñ—ó:</label>
                        <input type="text" id="sectionNumber" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä —Å–µ–∫—Ü—ñ—ó">
                    </div>
                    
                    <div class="form-group">
                        <label for="objectNumber">‚Ññ –æ–±'—î–∫—Ç—É:</label>
                        <input type="text" id="objectNumber" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä –æ–±'—î–∫—Ç—É">
                    </div>
                    
                    <div class="form-group">
                        <label for="planningType">–¢–∏–ø –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è:</label>
                        <input type="text" id="planningType" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–∏–ø –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è">
                    </div>
                    
                    <div class="form-group">
                        <label for="roomCount">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫—ñ–º–Ω–∞—Ç:</label>
                        <input type="number" id="roomCount" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫—ñ–º–Ω–∞—Ç" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="projectArea">–ü—Ä–æ–µ–∫—Ç–Ω–∞ –ø–ª–æ—â–∞, –º¬≤:</label>
                        <input type="number" id="projectArea" step="0.01" placeholder="0.00" min="0">
                    </div>
                </div>
                
                <div class="section dashboard">
                    <h2>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —É–≥–æ–¥—É</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å:</strong>
                            <span id="totalCost">0.00 USD</span>
                        </div>
                        <div class="info-item">
                            <strong>–ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫:</strong>
                            <span id="totalFirstPayment">0.00 USD</span>
                        </div>
                        <div class="info-item">
                            <strong>–©–æ–º—ñ—Å—è—á–Ω–∏–π –ø–ª–∞—Ç—ñ–∂:</strong>
                            <span id="monthlyPayment">0.00 USD</span>
                        </div>
                        <div class="info-item">
                            <strong>–ü–µ—Ä–µ–ø–ª–∞—Ç–∞:</strong>
                            <span id="overpayment">0.00 USD</span>
                        </div>
                        <div class="info-item">
                            <strong>–ï–∫–æ–Ω–æ–º—ñ—è –≤—ñ–¥ –∑–Ω–∏–∂–∫–∏:</strong>
                            <span id="discountSaving">0.00 USD</span>
                        </div>
                        <div class="info-item">
                            <strong>–¢–µ—Ä–º—ñ–Ω –ø–æ–≥–∞—à–µ–Ω–Ω—è:</strong>
                            <span id="paymentTerm">0 –º—ñ—Å.</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div>
                <div class="section">
                    <h2>–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫</h2>
                    
                    <div class="form-group">
                        <label for="objectCostUSD">–í–∞—Ä—Ç—ñ—Å—Ç—å –æ–±'—î–∫—Ç–∞ (USD):</label>
                        <input type="number" id="objectCostUSD" step="0.01" placeholder="0.00" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="exchangeRate">–ö—É—Ä—Å USD/UAH:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="exchangeRate" step="0.01" value="41.50" placeholder="41.50" min="0" style="flex: 1;">
                            <button class="exchange-rate-button" id="getOschadRate">–û—â–∞–¥–±–∞–Ω–∫</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–í–∞—Ä—Ç—ñ—Å—Ç—å –æ–±'—î–∫—Ç–∞ (UAH):</label>
                        <div class="currency-display" id="objectCostUAH">0.00 ‚Ç¥</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="costPerSqm">–í–∞—Ä—Ç—ñ—Å—Ç—å –º¬≤ (USD):</label>
                        <input type="number" id="costPerSqm" step="0.01" placeholder="0.00" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="firstPaymentPercent">–ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫ (%):</label>
                        <input type="number" id="firstPaymentPercent" step="0.1" value="10" placeholder="10.0" min="0" max="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="firstPaymentCount">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä—à–∏—Ö –≤–Ω–µ—Å–∫—ñ–≤:</label>
                        <select id="firstPaymentCount">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="firstPaymentDiscount">–ó–Ω–∏–∂–∫–∞ –Ω–∞ –ø–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫ (%):</label>
                        <input type="number" id="firstPaymentDiscount" step="0.1" value="0" placeholder="0.0" min="0" max="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="annualInterestRate">% –∑–¥–æ—Ä–æ–∂—á–∞–Ω–Ω—è (—Ä—ñ—á–Ω–∏–π):</label>
                        <input type="number" id="annualInterestRate" step="0.1" value="0" placeholder="0.0" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="gracePeriod">–ü—ñ–ª—å–≥–æ–≤—ñ –º—ñ—Å—è—Ü—ñ:</label>
                        <input type="number" id="gracePeriod" value="0" min="0" placeholder="0">
                    </div>
                    
                    <div class="form-group">
                        <label>–ó–∞–ª–∏—à–æ–∫ –ø–ª–∞—Ç–µ–∂—É (USD):</label>
                        <div class="currency-display" id="remainingPayment">0.00</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="installmentTerm">–¢–µ—Ä–º—ñ–Ω —Ä–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—è (–º—ñ—Å.):</label>
                        <input type="number" id="installmentTerm" value="12" min="0" placeholder="12">
                    </div>
                </div>
            </div>
            
            <div class="section payment-schedule-section">
                <h2>–ì—Ä–∞—Ñ—ñ–∫ –æ–ø–ª–∞—Ç</h2>
                <div style="overflow-x: auto;">
                    <table class="schedule-table" id="paymentSchedule">
                        <thead>
                            <tr>
                                <th>‚Ññ</th>
                                <th>–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂—É</th>
                                <th>–¢–∏–ø –ø–ª–∞—Ç–µ–∂—É</th>
                                <th>–¢—ñ–ª–æ –∫—Ä–µ–¥–∏—Ç—É (USD)</th>
                                <th>–í—ñ–¥—Å–æ—Ç–∫–∏ (USD)</th>
                                <th>–°—É–º–∞ (USD)</th>
                                <th>–°—É–º–∞ (UAH)</th>
                                <th>–ó–∞–ª–∏—à–æ–∫ (USD)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="8">–í–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="action-button" id="printBtn">
                <span>üñ®Ô∏è</span> –î—Ä—É–∫
            </button>
            <button class="action-button save" id="saveBtn">
                <span>üíæ</span> –ó–±–µ—Ä–µ–≥—Ç–∏ –≤ Excel
            </button>
        </div>
    </div>
    
    <script>
        class RealEstateCalculator {
            constructor() {
                this.isUpdating = false;
                this.init();
            }
            
            init() {
                this.setInitialDates();
                this.bindEventHandlers();
                this.calculate();
            }
            
            setInitialDates() {
                const today = new Date();
                const nextMonth = new Date();
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                
                document.getElementById('calculationDate').valueAsDate = today;
                document.getElementById('firstPaymentDate').valueAsDate = nextMonth;
            }
            
            bindEventHandlers() {
                const generalInputs = [
                    'exchangeRate', 'firstPaymentPercent', 'firstPaymentCount',
                    'firstPaymentDiscount', 'annualInterestRate', 'gracePeriod',
                    'installmentTerm', 'calculationDate', 'firstPaymentDate'
                ];
                
                generalInputs.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', () => this.calculate());
                        element.addEventListener('change', () => this.calculate());
                    }
                });
                
                const objectInfoInputs = [
                    'complexName', 'buildingNumber', 'sectionNumber', 
                    'objectNumber', 'planningType', 'roomCount'
                ];
                
                objectInfoInputs.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', () => this.calculate());
                        element.addEventListener('change', () => this.calculate());
                    }
                });
                
                document.getElementById('objectCostUSD').addEventListener('input', (e) => {
                    this.handleCostChange(e);
                });
                
                document.getElementById('costPerSqm').addEventListener('input', (e) => {
                    this.handleSqmPriceChange(e);
                });
                
                document.getElementById('projectArea').addEventListener('input', (e) => {
                    this.handleAreaChange(e);
                });
                
                document.getElementById('getOschadRate').addEventListener('click', () => {
                    this.getOschadbankExchangeRate();
                });
                
                document.getElementById('printBtn').addEventListener('click', () => {
                    window.print();
                });
                
                document.getElementById('saveBtn').addEventListener('click', () => {
                    this.saveToExcel();
                });
            }
            
            handleCostChange(e) {
                if (this.isUpdating) return;
                
                const cost = parseFloat(e.target.value) || 0;
                const area = parseFloat(document.getElementById('projectArea').value) || 0;
                
                if (cost > 0 && area > 0) {
                    this.isUpdating = true;
                    document.getElementById('costPerSqm').value = (cost / area).toFixed(2);
                    this.isUpdating = false;
                }
                
                this.calculate();
            }
            
            handleSqmPriceChange(e) {
                if (this.isUpdating) return;
                
                const sqmPrice = parseFloat(e.target.value) || 0;
                const area = parseFloat(document.getElementById('projectArea').value) || 0;
                
                if (sqmPrice > 0 && area > 0) {
                    this.isUpdating = true;
                    document.getElementById('objectCostUSD').value = (sqmPrice * area).toFixed(2);
                    this.isUpdating = false;
                }
                
                this.calculate();
            }
            
            handleAreaChange(e) {
                if (this.isUpdating) return;
                
                const area = parseFloat(e.target.value) || 0;
                const sqmPrice = parseFloat(document.getElementById('costPerSqm').value) || 0;
                
                if (area > 0 && sqmPrice > 0) {
                    this.isUpdating = true;
                    document.getElementById('objectCostUSD').value = (sqmPrice * area).toFixed(2);
                    this.isUpdating = false;
                    this.calculate();
                } else if (area > 0) {
                    const cost = parseFloat(document.getElementById('objectCostUSD').value) || 0;
                    if (cost > 0) {
                        this.isUpdating = true;
                        document.getElementById('costPerSqm').value = (cost / area).toFixed(2);
                        this.isUpdating = false;
                    }
                }
            }
            
            async getOschadbankExchangeRate() {
                const button = document.getElementById('getOschadRate');
                const originalText = button.textContent;
                
                try {
                    button.disabled = true;
                    button.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
                    
                    const response = await fetch('https://api.oschadbank.ua/currency');
                    
                    if (response.ok) {
                        const data = await response.json();
                        const usdRate = data.find(currency => currency.ccy === 'USD');
                        
                        if (usdRate && usdRate.sale) {
                            const rate = parseFloat(usdRate.sale);
                            document.getElementById('exchangeRate').value = rate.toFixed(2);
                            alert(`–ö—É—Ä—Å USD –≤—ñ–¥ –û—â–∞–¥–±–∞–Ω–∫—É: ${rate.toFixed(2)} –≥—Ä–Ω`);
                            this.calculate();
                        } else {
                            throw new Error('USD –∫—É—Ä—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                        }
                    } else {
                        throw new Error('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö');
                    }
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫—É—Ä—Å—É –û—â–∞–¥–±–∞–Ω–∫—É:', error);
                    
                    try {
                        const nbuResponse = await fetch('https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange?json');
                        if (nbuResponse.ok) {
                            const nbuData = await nbuResponse.json();
                            const usdRate = nbuData.find(currency => currency.cc === 'USD');
                            
                            if (usdRate && usdRate.rate) {
                                const rate = parseFloat(usdRate.rate);
                                document.getElementById('exchangeRate').value = rate.toFixed(2);
                                alert(`–ö—É—Ä—Å USD –≤—ñ–¥ –ù–ë–£ (—Ä–µ–∑–µ—Ä–≤–Ω–∏–π): ${rate.toFixed(2)} –≥—Ä–Ω`);
                                this.calculate();
                            } else {
                                throw new Error('–ö—É—Ä—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                            }
                        } else {
                            throw new Error('–ü–æ–º–∏–ª–∫–∞ NBU API');
                        }
                    } catch (nbuError) {
                        console.error('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫—É—Ä—Å—É –ù–ë–£:', nbuError);
                        const fixedRate = 41.50;
                        document.getElementById('exchangeRate').value = fixedRate.toFixed(2);
                        alert(`–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π –∫—É—Ä—Å. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π: ${fixedRate.toFixed(2)} –≥—Ä–Ω`);
                        this.calculate();
                    }
                } finally {
                    button.disabled = false;
                    button.textContent = originalText;
                }
            }
            
            calculate() {
                const data = this.getFormData();
                
                document.getElementById('objectCostUAH').textContent = 
                    (data.objectCostUSD * data.exchangeRate).toFixed(2) + ' ‚Ç¥';
                
                const firstPaymentAmount = (data.objectCostUSD * data.firstPaymentPercent) / 100;
                const remainingAmount = data.objectCostUSD - firstPaymentAmount;
                document.getElementById('remainingPayment').textContent = remainingAmount.toFixed(2);
                
                this.generateSchedule(data);
                this.updateDashboard(data);
            }
            
            getFormData() {
                return {
                    objectCostUSD: parseFloat(document.getElementById('objectCostUSD').value) || 0,
                    exchangeRate: parseFloat(document.getElementById('exchangeRate').value) || 41.50,
                    firstPaymentPercent: parseFloat(document.getElementById('firstPaymentPercent').value) || 0,
                    firstPaymentCount: parseInt(document.getElementById('firstPaymentCount').value) || 1,
                    firstPaymentDiscount: parseFloat(document.getElementById('firstPaymentDiscount').value) || 0,
                    installmentTerm: parseInt(document.getElementById('installmentTerm').value) || 0,
                    annualInterestRate: parseFloat(document.getElementById('annualInterestRate').value) || 0,
                    gracePeriod: parseInt(document.getElementById('gracePeriod').value) || 0,
                    firstPaymentDate: document.getElementById('firstPaymentDate').value
                };
            }
            
            generateSchedule(data) {
                const tbody = document.querySelector('#paymentSchedule tbody');
                
                if (data.objectCostUSD === 0) {
                    tbody.innerHTML = '<tr><td colspan="8">–í–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É</td></tr>';
                    return;
                }
                
                // –õ–û–ì–Ü–ö–ê –ó –í–ê–®–û–ì–û –ö–û–†–ï–ö–¢–ù–û–ì–û –§–ê–ô–õ–£
                
                // 1. –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –ø–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫
                const firstPaymentTotal = data.objectCostUSD * data.firstPaymentPercent / 100;
                const discount = firstPaymentTotal * data.firstPaymentDiscount / 100;
                const firstPaymentAfterDiscount = firstPaymentTotal - discount;
                const firstPaymentPerInstallment = firstPaymentAfterDiscount / data.firstPaymentCount;
                
                // 2. –ó–∞–ª–∏—à–æ–∫ –¥–ª—è —Ä–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—è (–ø—ñ—Å–ª—è –≤—Å—ñ—Ö –ø–µ—Ä—à–∏—Ö –≤–Ω–µ—Å–∫—ñ–≤)
                const loanAmount = data.objectCostUSD - firstPaymentTotal;
                
                // 3. –ú—ñ—Å—è—á–Ω–∞ —Å—Ç–∞–≤–∫–∞
                const monthlyRate = data.annualInterestRate / 100 / 12;
                
                let rows = [];
                let paymentNum = 0;
                let totalPaid = 0;
                let totalInterest = 0;
                let currentBalance = data.objectCostUSD; // –î–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ —Ç–∞–±–ª–∏—Ü—ñ
                const startDate = new Date(data.firstPaymentDate);
                
                // –ü–ï–†–®–Ü –í–ù–ï–°–ö–ò
                for (let i = 0; i < data.firstPaymentCount; i++) {
                    paymentNum++;
                    currentBalance -= firstPaymentPerInstallment;
                    totalPaid += firstPaymentPerInstallment;
                    
                    const paymentDate = new Date(startDate);
                    paymentDate.setMonth(paymentDate.getMonth() + i);
                    
                    rows.push(`
                        <tr class="first-payment">
                            <td>${paymentNum}</td>
                            <td>${this.formatDate(paymentDate)}</td>
                            <td>–ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫ ${i + 1}/${data.firstPaymentCount}</td>
                            <td>${firstPaymentPerInstallment.toFixed(2)}</td>
                            <td>0.00</td>
                            <td>${firstPaymentPerInstallment.toFixed(2)}</td>
                            <td>${(firstPaymentPerInstallment * data.exchangeRate).toFixed(2)}</td>
                            <td>${currentBalance.toFixed(2)}</td>
                        </tr>
                    `);
                }
                
                // –†–û–ó–¢–ï–†–ú–Ü–ù–£–í–ê–ù–ù–Ø (—è–∫—â–æ —î –∑–∞–ª–∏—à–æ–∫)
                if (data.installmentTerm > 0 && loanAmount > 0) {
                    
                    if (monthlyRate === 0) {
                        // –ë–ï–ó –í–Ü–î–°–û–¢–ö–Ü–í - –ø—Ä–æ—Å—Ç–æ –¥—ñ–ª–∏–º–æ —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–æ
                        const monthlyPayment = loanAmount / data.installmentTerm;
                        let loanBalance = loanAmount;
                        
                        for (let i = 0; i < data.installmentTerm; i++) {
                            paymentNum++;
                            
                            let interest = 0;
                            let principal = monthlyPayment;
                            
                            // –ü—ñ–ª—å–≥–æ–≤—ñ –º—ñ—Å—è—Ü—ñ –Ω–µ –≤–ø–ª–∏–≤–∞—é—Ç—å –ø—Ä–∏ 0% —Å—Ç–∞–≤—Ü—ñ
                            if (i === data.installmentTerm - 1) {
                                principal = loanBalance; // –û—Å—Ç–∞–Ω–Ω—ñ–π –ø–ª–∞—Ç—ñ–∂ - –≤–µ—Å—å –∑–∞–ª–∏—à–æ–∫
                            }
                            
                            const totalPayment = principal + interest;
                            loanBalance -= principal;
                            currentBalance -= totalPayment;
                            totalPaid += totalPayment;
                            
                            const paymentDate = new Date(startDate);
                            paymentDate.setMonth(paymentDate.getMonth() + data.firstPaymentCount + i);
                            
                            const rowClass = i < data.gracePeriod ? 'grace-period' : '';
                            const paymentType = i < data.gracePeriod ? 
                                `–ü—ñ–ª—å–≥–æ–≤–∏–π –ø–µ—Ä—ñ–æ–¥ ${i + 1}/${data.installmentTerm}` : 
                                `–©–æ–º—ñ—Å—è—á–Ω–∏–π –ø–ª–∞—Ç—ñ–∂ ${i + 1}/${data.installmentTerm}`;
                            
                            rows.push(`
                                <tr class="${rowClass}">
                                    <td>${paymentNum}</td>
                                    <td>${this.formatDate(paymentDate)}</td>
                                    <td>${paymentType}</td>
                                    <td>${principal.toFixed(2)}</td>
                                    <td>${interest.toFixed(2)}</td>
                                    <td>${totalPayment.toFixed(2)}</td>
                                    <td>${(totalPayment * data.exchangeRate).toFixed(2)}</td>
                                    <td>${Math.max(0, loanBalance).toFixed(2)}</td>
                                </tr>
                            `);
                        }
                    } else {
                        // –ó –í–Ü–î–°–û–¢–ö–ê–ú–ò - –ö–û–†–ï–ö–¢–ù–ò–ô –ê–õ–ì–û–†–ò–¢–ú –ó –ü–Ü–õ–¨–ì–û–í–ò–ú–ò –ú–Ü–°–Ø–¶–Ø–ú–ò
                        
                        // 1. –†–æ–∑—Ä–∞—Ö—É—î–º–æ —Å–∫—ñ–ª—å–∫–∏ –±—É–¥–µ —Å–ø–ª–∞—á–µ–Ω–æ –≤ –ø—ñ–ª—å–≥–æ–≤–∏–π –ø–µ—Ä—ñ–æ–¥
                        const gracePeriodPayment = data.gracePeriod > 0 ? 
                            Math.round((loanAmount / data.installmentTerm) * 100) / 100 : 0;
                        const totalGracePeriodPaid = gracePeriodPayment * data.gracePeriod;
                        
                        // 2. –ó–∞–ª–∏—à–æ–∫ –ø—ñ—Å–ª—è –ø—ñ–ª—å–≥–æ–≤–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É (–Ω–∞ —è–∫–∏–π –±—É–¥—É—Ç—å –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏—Å—å –≤—ñ–¥—Å–æ—Ç–∫–∏)
                        const remainingAfterGrace = loanAmount - totalGracePeriodPaid;
                        
                        // 3. –ö—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—è—Ü—ñ–≤ –∑ –≤—ñ–¥—Å–æ—Ç–∫–∞–º–∏
                        const interestTerms = data.installmentTerm - data.gracePeriod;
                        
                        // 4. –ê–Ω–Ω—É—ó—Ç–µ—Ç–Ω–∏–π –ø–ª–∞—Ç—ñ–∂ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –¢–Ü–õ–¨–ö–ò –¥–ª—è –∑–∞–ª–∏—à–∫—É –ø—ñ—Å–ª—è –ø—ñ–ª—å–≥–æ–≤–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É
                        let A_show = 0;
                        if (interestTerms > 0 && remainingAfterGrace > 0) {
                            const A = remainingAfterGrace * (monthlyRate * Math.pow(1 + monthlyRate, interestTerms)) / 
                                     (Math.pow(1 + monthlyRate, interestTerms) - 1);
                            A_show = Math.round(A * 100) / 100;
                        }
                        
                        // B = P (–ø–æ—á–∞—Ç–∫–æ–≤–∏–π –±–∞–ª–∞–Ω—Å)
                        let B = loanAmount;
                        
                        // –¶–ò–ö–õ –î–õ–Ø –í–°–Ü–• –ú–Ü–°–Ø–¶–Ü–í 1..n-1
                        for (let k = 1; k <= data.installmentTerm - 1; k++) {
                            paymentNum++;
                            
                            let I, D, payment;
                            
                            if (k <= data.gracePeriod) {
                                // –ü–Ü–õ–¨–ì–û–í–Ü –ú–Ü–°–Ø–¶–Ü - –≤—ñ–¥—Å–æ—Ç–∫–∏ = 0
                                I = 0; 
                                D = gracePeriodPayment; // –†—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞
                                payment = D;
                            } else {
                                // –ó–í–ò–ß–ê–ô–ù–Ü –ú–Ü–°–Ø–¶–Ü - –∞–Ω–Ω—É—ó—Ç–µ—Ç–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –∑–∞–ª–∏—à–æ–∫
                                I = Math.round(B * monthlyRate * 100) / 100; // round(B * i, 2)
                                D = Math.round((A_show - I) * 100) / 100;     // round(A_show - I, 2)
                                payment = A_show;
                            }
                            
                            B = B - D; // –ó–º–µ–Ω—à—É—î–º–æ –±–∞–ª–∞–Ω—Å –Ω–∞ –æ—Å–Ω–æ–≤–Ω–∏–π –±–æ—Ä–≥
                            currentBalance -= payment;
                            totalPaid += payment;
                            totalInterest += I;
                            
                            const paymentDate = new Date(startDate);
                            paymentDate.setMonth(paymentDate.getMonth() + data.firstPaymentCount + k - 1);
                            
                            const rowClass = k <= data.gracePeriod ? 'grace-period' : '';
                            const paymentType = k <= data.gracePeriod ? 
                                `–ü—ñ–ª—å–≥–æ–≤–∏–π –ø–µ—Ä—ñ–æ–¥ ${k}/${data.installmentTerm}` : 
                                `–©–æ–º—ñ—Å—è—á–Ω–∏–π –ø–ª–∞—Ç—ñ–∂ ${k}/${data.installmentTerm}`;
                            
                            rows.push(`
                                <tr class="${rowClass}">
                                    <td>${paymentNum}</td>
                                    <td>${this.formatDate(paymentDate)}</td>
                                    <td>${paymentType}</td>
                                    <td>${D.toFixed(2)}</td>
                                    <td>${I.toFixed(2)}</td>
                                    <td>${payment.toFixed(2)}</td>
                                    <td>${(payment * data.exchangeRate).toFixed(2)}</td>
                                    <td>${Math.max(0, B).toFixed(2)}</td>
                                </tr>
                            `);
                        }
                        
                        // –û–°–¢–ê–ù–ù–Ü–ô –ú–Ü–°–Ø–¶–¨
                        paymentNum++;
                        
                        let I_last, A_last, D_last;
                        
                        if (data.installmentTerm <= data.gracePeriod) {
                            // –û—Å—Ç–∞–Ω–Ω—ñ–π –º—ñ—Å—è—Ü—å —Ç–∞–∫–æ–∂ –ø—ñ–ª—å–≥–æ–≤–∏–π
                            I_last = 0;
                            D_last = Math.round(B * 100) / 100; // –í–µ—Å—å –∑–∞–ª–∏—à–æ–∫
                            A_last = D_last;
                        } else {
                            // –û—Å—Ç–∞–Ω–Ω—ñ–π –º—ñ—Å—è—Ü—å –∑–≤–∏—á–∞–π–Ω–∏–π - –∑ –≤—ñ–¥—Å–æ—Ç–∫–∞–º–∏
                            I_last = Math.round(B * monthlyRate * 100) / 100; // round(B * i, 2)
                            A_last = Math.round((B + I_last) * 100) / 100;    // round(B + I, 2)
                            D_last = Math.round((A_last - I_last) * 100) / 100; // round(A_last - I, 2)
                        }
                        
                        B = B - D_last; // should be 0.00
                        
                        currentBalance -= A_last;
                        totalPaid += A_last;
                        totalInterest += I_last;
                        
                        const lastPaymentDate = new Date(startDate);
                        lastPaymentDate.setMonth(lastPaymentDate.getMonth() + data.firstPaymentCount + data.installmentTerm - 1);
                        
                        const isLastGrace = data.installmentTerm <= data.gracePeriod;
                        const lastRowClass = isLastGrace ? 'grace-period' : '';
                        const lastPaymentType = isLastGrace ? 
                            `–ü—ñ–ª—å–≥–æ–≤–∏–π –ø–µ—Ä—ñ–æ–¥ ${data.installmentTerm}/${data.installmentTerm}` : 
                            `–©–æ–º—ñ—Å—è—á–Ω–∏–π –ø–ª–∞—Ç—ñ–∂ ${data.installmentTerm}/${data.installmentTerm}`;
                        
                        rows.push(`
                            <tr class="${lastRowClass}">
                                <td>${paymentNum}</td>
                                <td>${this.formatDate(lastPaymentDate)}</td>
                                <td>${lastPaymentType}</td>
                                <td>${D_last.toFixed(2)}</td>
                                <td>${I_last.toFixed(2)}</td>
                                <td>${A_last.toFixed(2)}</td>
                                <td>${(A_last * data.exchangeRate).toFixed(2)}</td>
                                <td>${Math.max(0, B).toFixed(2)}</td>
                            </tr>
                        `);
                    }
                }
                
                // –ü—ñ–¥—Å—É–º–æ–∫
                rows.push(`
                    <tr class="table-total">
                        <td colspan="3">–ó–ê–ì–ê–õ–û–ú:</td>
                        <td>${(totalPaid - totalInterest).toFixed(2)}</td>
                        <td>${totalInterest.toFixed(2)}</td>
                        <td>${totalPaid.toFixed(2)}</td>
                        <td>${(totalPaid * data.exchangeRate).toFixed(2)}</td>
                        <td>0.00</td>
                    </tr>
                `);
                
                tbody.innerHTML = rows.join('');
            }
            
            updateDashboard(data) {
                const firstPaymentAmount = (data.objectCostUSD * data.firstPaymentPercent) / 100;
                const discountAmount = (firstPaymentAmount * data.firstPaymentDiscount) / 100;
                const discountedFirstPayment = firstPaymentAmount - discountAmount;
                const remainingAmount = data.objectCostUSD - firstPaymentAmount;
                
                let totalMonthlyPayments = 0;
                let avgMonthlyPayment = 0;
                
                if (data.installmentTerm > 0 && remainingAmount > 0) {
                    const monthlyRate = data.annualInterestRate / 100 / 12;
                    
                    if (monthlyRate === 0) {
                        // –ë–µ–∑ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤
                        avgMonthlyPayment = remainingAmount / data.installmentTerm;
                        totalMonthlyPayments = remainingAmount;
                    } else {
                        // –ó –≤—ñ–¥—Å–æ—Ç–∫–∞–º–∏ - –í–†–ê–•–û–í–£–Ñ–ú–û –ü–Ü–õ–¨–ì–û–í–Ü –ú–Ü–°–Ø–¶–Ü
                        
                        // 1. –†–æ–∑—Ä–∞—Ö—É—î–º–æ —Å–∫—ñ–ª—å–∫–∏ –±—É–¥–µ —Å–ø–ª–∞—á–µ–Ω–æ –≤ –ø—ñ–ª—å–≥–æ–≤–∏–π –ø–µ—Ä—ñ–æ–¥
                        const gracePeriodPayment = data.gracePeriod > 0 ? 
                            remainingAmount / data.installmentTerm : 0;
                        const totalGracePeriodPaid = gracePeriodPayment * data.gracePeriod;
                        
                        // 2. –ó–∞–ª–∏—à–æ–∫ –ø—ñ—Å–ª—è –ø—ñ–ª—å–≥–æ–≤–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É
                        const remainingAfterGrace = remainingAmount - totalGracePeriodPaid;
                        
                        // 3. –ö—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—è—Ü—ñ–≤ –∑ –≤—ñ–¥—Å–æ—Ç–∫–∞–º–∏
                        const interestTerms = data.installmentTerm - data.gracePeriod;
                        
                        if (interestTerms > 0 && remainingAfterGrace > 0) {
                            // 4. –ê–Ω–Ω—É—ó—Ç–µ—Ç–Ω–∏–π –ø–ª–∞—Ç—ñ–∂ –¥–ª—è –∑–∞–ª–∏—à–∫—É –ø—ñ—Å–ª—è –ø—ñ–ª—å–≥–æ–≤–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É
                            avgMonthlyPayment = remainingAfterGrace * monthlyRate * Math.pow(1 + monthlyRate, interestTerms) / 
                                              (Math.pow(1 + monthlyRate, interestTerms) - 1);
                            
                            // 5. –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –∑–∞ –º—ñ—Å—è—Ü—ñ –∑ –≤—ñ–¥—Å–æ—Ç–∫–∞–º–∏
                            const totalInterestPayments = avgMonthlyPayment * interestTerms;
                            
                            // 6. –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ —Ä–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—è = –ø—ñ–ª—å–≥–æ–≤—ñ + –∑ –≤—ñ–¥—Å–æ—Ç–∫–∞–º–∏
                            totalMonthlyPayments = totalGracePeriodPaid + totalInterestPayments;
                        } else {
                            // –í—Å—ñ –º—ñ—Å—è—Ü—ñ –ø—ñ–ª—å–≥–æ–≤—ñ
                            avgMonthlyPayment = gracePeriodPayment;
                            totalMonthlyPayments = remainingAmount;
                        }
                    }
                }
                
                const totalCost = discountedFirstPayment + totalMonthlyPayments;
                const overpayment = totalCost - data.objectCostUSD;
                const totalTerm = data.installmentTerm === 0 ? data.firstPaymentCount : data.firstPaymentCount + data.installmentTerm;
                
                document.getElementById('totalCost').textContent = totalCost.toFixed(2) + ' USD';
                document.getElementById('totalFirstPayment').textContent = discountedFirstPayment.toFixed(2) + ' USD';
                document.getElementById('monthlyPayment').textContent = avgMonthlyPayment.toFixed(2) + ' USD';
                document.getElementById('overpayment').textContent = overpayment.toFixed(2) + ' USD';
                document.getElementById('discountSaving').textContent = discountAmount.toFixed(2) + ' USD';
                document.getElementById('paymentTerm').textContent = totalTerm + ' –º—ñ—Å.';
            }
            
            formatDate(date) {
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}.${month}.${year}`;
            }
            
            saveToExcel() {
                const calculationDate = document.getElementById('calculationDate').value;
                const complexName = document.getElementById('complexName').value;
                const objectCostUSD = parseFloat(document.getElementById('objectCostUSD').value) || 0;
                
                if (objectCostUSD === 0) {
                    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –ø–µ—Ä–µ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º');
                    return;
                }
                
                try {
                    const wb = XLSX.utils.book_new();
                    
                    const calculationData = [
                        ['–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∞—Ä—Ç–æ—Å—Ç—ñ –Ω–µ—Ä—É—Ö–æ–º–æ—Å—Ç—ñ'],
                        [''],
                        ['–î–∞—Ç–∞ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É:', calculationDate],
                        ['–ù–∞–∑–≤–∞ –ñ–ö:', complexName],
                        ['–ù–æ–º–µ—Ä –±—É–¥–∏–Ω–∫—É:', document.getElementById('buildingNumber').value],
                        ['–ù–æ–º–µ—Ä —Å–µ–∫—Ü—ñ—ó:', document.getElementById('sectionNumber').value],
                        ['‚Ññ –æ–±\'—î–∫—Ç—É:', document.getElementById('objectNumber').value],
                        ['–¢–∏–ø –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è:', document.getElementById('planningType').value],
                        ['–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫—ñ–º–Ω–∞—Ç:', document.getElementById('roomCount').value],
                        ['–ü—Ä–æ–µ–∫—Ç–Ω–∞ –ø–ª–æ—â–∞, –º¬≤:', document.getElementById('projectArea').value],
                        [''],
                        ['–í–∞—Ä—Ç—ñ—Å—Ç—å –æ–±\'—î–∫—Ç–∞ (USD):', objectCostUSD],
                        ['–ö—É—Ä—Å USD/UAH:', document.getElementById('exchangeRate').value],
                        ['–í–∞—Ä—Ç—ñ—Å—Ç—å –æ–±\'—î–∫—Ç–∞ (UAH):', objectCostUSD * parseFloat(document.getElementById('exchangeRate').value)],
                        ['–í–∞—Ä—Ç—ñ—Å—Ç—å –º¬≤ (USD):', document.getElementById('costPerSqm').value],
                        ['–ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫ (%):', document.getElementById('firstPaymentPercent').value],
                        ['–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä—à–∏—Ö –≤–Ω–µ—Å–∫—ñ–≤:', document.getElementById('firstPaymentCount').value],
                        ['–ó–Ω–∏–∂–∫–∞ –Ω–∞ –ø–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫ (%):', document.getElementById('firstPaymentDiscount').value],
                        ['% –∑–¥–æ—Ä–æ–∂—á–∞–Ω–Ω—è (—Ä—ñ—á–Ω–∏–π):', document.getElementById('annualInterestRate').value],
                        ['–ü—ñ–ª—å–≥–æ–≤—ñ –º—ñ—Å—è—Ü—ñ:', document.getElementById('gracePeriod').value],
                        ['–¢–µ—Ä–º—ñ–Ω —Ä–æ–∑—Ç–µ—Ä–º—ñ–Ω—É–≤–∞–Ω–Ω—è (–º—ñ—Å.):', document.getElementById('installmentTerm').value],
                        [''],
                        ['–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å:', document.getElementById('totalCost').textContent],
                        ['–ü–µ—Ä—à–∏–π –≤–Ω–µ—Å–æ–∫:', document.getElementById('totalFirstPayment').textContent],
                        ['–©–æ–º—ñ—Å—è—á–Ω–∏–π –ø–ª–∞—Ç—ñ–∂:', document.getElementById('monthlyPayment').textContent],
                        ['–ü–µ—Ä–µ–ø–ª–∞—Ç–∞:', document.getElementById('overpayment').textContent],
                        ['–ï–∫–æ–Ω–æ–º—ñ—è –≤—ñ–¥ –∑–Ω–∏–∂–∫–∏:', document.getElementById('discountSaving').textContent],
                        ['–¢–µ—Ä–º—ñ–Ω –ø–æ–≥–∞—à–µ–Ω–Ω—è:', document.getElementById('paymentTerm').textContent]
                    ];
                    
                    const ws_calc = XLSX.utils.aoa_to_sheet(calculationData);
                    XLSX.utils.book_append_sheet(wb, ws_calc, "–î–∞–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É");
                    
                    const table = document.getElementById('paymentSchedule');
                    const ws_schedule = XLSX.utils.table_to_sheet(table);
                    XLSX.utils.book_append_sheet(wb, ws_schedule, "–ì—Ä–∞—Ñ—ñ–∫ –ø–ª–∞—Ç–µ–∂—ñ–≤");
                    
                    const fileName = `–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫_–Ω–µ—Ä—É—Ö–æ–º–æ—Å—Ç—ñ_${complexName}_${calculationDate.replace(/-/g, '')}.xlsx`;
                    XLSX.writeFile(wb, fileName);
                    
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Excel:', error);
                    alert('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
                }
            }
        }
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
        document.addEventListener('DOMContentLoaded', function() {
            window.calculator = new RealEstateCalculator();
        });
    </script>
</body>
</html>